<!DOCTYPE html>
<html>
<head lang="ko_KR">

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Developer KimChanJung's Blog" />
    <link rel="alternate" hreflang="ko-kr" href="https://kimchanjung.github.io/" />
    <link rel="alternate" hreflang="x-default" href="https://kimchanjung.github.io/" />
    <link rel="shortcut icon" href="https://kimchanjung.github.io/assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://kimchanjung.github.io/programming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="mogomezwai" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결" />
    <meta property="og:description" content="@EntityListeners로 지정한 클래스에 의존성이 필요한 경우 @autowired를 통한 의존성 주입이 동작하지 않는 문제가 있습니다 설명과 예제를 통하여 원인과 해결방법을 알아보도록 하겠습니다 JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결 JPA Entity 클래스에 @EntityListeners 추가 하여 엔티티의 CRUD가 일어날때 로그를 남긴다던가 하는 추가 작업을 선언하여 코드 중복을 줄일 수 있습니다." />
    <meta property="og:url" content="https://kimchanjung.github.io/programming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/" />
    <meta property="og:image" content="https://kimchanjung.github.io/assets/images/post-default-spring-cover.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/mogomezwai" />
    <meta property="article:author" content="https://www.facebook.com/mogomezwai" />
    <meta property="article:published_time" content="2020-06-28T20:00:00+09:00" />
    <meta property="article:modified_time" content="2020-06-28T20:00:00+09:00" />
    <meta property="article:tag" content="Programming" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결" />
    <meta name="twitter:description" content="@EntityListeners로 지정한 클래스에 의존성이 필요한 경우 @autowired를 통한 의존성 주입이 동작하지 않는 문제가 있습니다 설명과 예제를 통하여 원인과 해결방법을 알아보도록 하겠습니다 JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결 JPA Entity 클래스에 @EntityListeners 추가 하여 엔티티의 CRUD가 일어날때 로그를 남긴다던가 하는 추가 작업을 선언하여 코드 중복을 줄일 수 있습니다." />
    <meta name="twitter:url" content="https://kimchanjung.github.io/" />
    <meta name="twitter:image" content="https://kimchanjung.github.io/assets/images/post-default-spring-cover.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="mogomezwai" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Programming" />
    <meta name="twitter:site" content="@mogomezwai" />
    <meta name="twitter:creator" content="@mogomezwai" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "mogomezwai",
        "logo": "https://kimchanjung.github.io/assets/images/mogomezwai-logo.png"
    },
    "url": "https://kimchanjung.github.io/programming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/",
    "image": {
        "@type": "ImageObject",
        "url": "https://kimchanjung.github.io/assets/images/post-default-spring-cover.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://kimchanjung.github.io/programming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/"
    },
    "description": "@EntityListeners로 지정한 클래스에 의존성이 필요한 경우 @autowired를 통한 의존성 주입이 동작하지 않는 문제가 있습니다 설명과 예제를 통하여 원인과 해결방법을 알아보도록 하겠습니다 JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결 JPA Entity 클래스에 @EntityListeners 추가 하여 엔티티의 CRUD가 일어날때 로그를 남긴다던가 하는 추가 작업을 선언하여 코드 중복을 줄일 수 있습니다."
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결" href="/feed.xml" />
    <meta name="naver-site-verification" content="f1cd735caec0d9f78c0108426288fb40e725f65f" />

</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://kimchanjung.github.io/"><img src="/assets/images/mogomezwai-logo.png" alt="mogomezwai" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-resume" role="menuitem"><a href="/resume/">Resume</a></li>
    <li class="nav-projects" role="menuitem"><a href="/tag/projects/">Projects</a></li>
    <li class="nav-tech" role="menuitem"><a href="/tag/tech/">Tech</a></li>
    <li class="nav-programming" role="menuitem"><a href="/tag/programming/">Programming</a></li>
    <li class="nav-design-pattern" role="menuitem"><a href="/tag/design-pattern/">Design Pattern</a></li>
    <li class="nav-algorithm" role="menuitem"><a href="/tag/algorithm/">Algorithm</a></li>
    <li class="nav-etc" role="menuitem"><a href="/tag/etc/">Etc</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-tw" href="mailto:mogomezwai@gmail.com" target="_blank" rel="noopener">
<svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path></svg></a>
            
            
                <a class="social-link social-link-fb" href="https://facebook.com/mogomezwai" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/mogomezwai" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
            <a class="social-link social-link-rss" href="https://feedly.com/i/subscription/feed/https://kimchanjung.github.io/feed.xml" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>
            
            <!-- <a class="subscribe-button" href="#subscribe">search</a> -->
            <a class="social-link social-link-fb" href="#subscribe" ><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" ><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg></a>
            
        </div>
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-programming post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="28 June 2020">28 June 2020</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/programming/'>PROGRAMMING</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/post-default-spring-cover.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>@EntityListeners로 지정한 클래스에 의존성이 필요한 경우 @autowired를 통한 의존성 주입이 동작하지 않는 문제가 있습니다 설명과 예제를 통하여 원인과 해결방법을 알아보도록 하겠습니다</p>

<h1 id="jpa-entitylisteners에서-autowired를-통한-의존성-주입이-미동작하는-문제-해결">JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결</h1>
<p><strong>JPA Entity 클래스에 @EntityListeners 추가</strong> 하여 엔티티의 <strong>CRUD가 일어날때 로그</strong>를 남긴다던가 하는 <strong>추가 작업</strong>을 선언하여 <strong>코드 중복을 줄일</strong> 수 있습니다.<br />
하지만 <strong>@EntityListeners</strong>로 지정한 클래스에 <strong>의존성이 필요한 경우 @autowired</strong>를 통한 의존성 주입이 <strong>동작하지 않는 문제</strong>가 있습니다. 설명과 예제를 통하여 원인과 해결방법을 알아보도록 하겠습니다.</p>

<h2 id="entity-클래스">Entity 클래스</h2>
<p><strong>Rider</strong> 엔티티 클래스에 <strong>@EntityListeners</strong>로 <strong>CRUD</strong>이벤트를 처리할 listner 클래스를 등록합니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@EntityListeners</span><span class="o">(</span><span class="n">RiderEntityListener</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Rider</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userId</span><span class="o">;</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>@EntityListeners로 지정된 RiderEntityListener 클래스에 CRUD 해당하는 액션이 일어 날때 추가 작업을 정의할 수 있다.</p>
</blockquote>

<h2 id="riderentitylistener-클래스">RiderEntityListener 클래스</h2>
<p><strong>Rider</strong> 엔티티 <strong>CRUD</strong>이벤트를 처리하는 <strong>RiderEntityListener</strong>에 스냅샷을 저장하는 <strong>RiderLog 앤티티</strong>를 생성하고 저장하기위해 <strong>RiderLogRepository의 의존성을 추가</strong>합니다. <br />
<strong>Rider</strong>엔티티를 조작하는 코드마다 <strong>로그를 남기는 코드의 중복을 제거</strong>할 용도로 사용할 수 있습니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderEntityListener</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">RiderLogRepository</span> <span class="n">riderLogRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">RiderEntityListener</span><span class="o">(</span><span class="n">RiderLogRepository</span> <span class="n">riderLogRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">riderLogRepository</span> <span class="o">=</span> <span class="n">riderLogRepository</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * INSERT 이후 호출됨
     * @param riderAccount
     */</span>
    <span class="nd">@PostPersist</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postPersist</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">riderLogRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">RiderLog</span><span class="o">(</span><span class="n">rider</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="cm">/**
     * UPDATE 완료 후 호출
     * @param riderAccount
     */</span>
    <span class="nd">@PostUpdate</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postUpdate</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">riderLogRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">RiderLog</span><span class="o">(</span><span class="n">rider</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div></div>
<blockquote>
  <p>RiderLogRepository 클래스를 @Autowired를 통한 DI를 했지만 NPE가 발생합니다. 즉 DI가 되지 않았던 것 입니다.</p>
</blockquote>

<h2 id="riderlogrepository가-di-되지-않았던-이유">RiderLogRepository가 DI 되지 않았던 이유</h2>
<p><strong>EntityListeners로 등록한 클래스</strong>는 <strong>Spring IOC 컨테이너의 관리 대상이 아닙</strong>니다. 그렇기 때문에 스프링 애플리케이션이 실행되는 과정에서 <strong>빈이 생성되고 등록되는 중</strong>에 <strong>EntityListeners로 등록한 클래스가 먼저 생성</strong> 되었을 수 있습니다. <br />
즉 의존성 빈과 EntityListeners로 등록한 클래스가 <strong>생성되는 시점이 서로 다른 것</strong>입니다.
<strong>타이밍이 잘 맞으면 의존성이 주입되어 있지만 그렇지 않으면 null인경우</strong>가 발생하는 것 입니다.</p>

<h2 id="spring-applicationevent를-통해서-분리하여-해결하는-법">Spring ApplicationEvent를 통해서 분리하여 해결하는 법</h2>
<p>이 문제와 관련하여 구글링을 해보면 <strong>몇 가지 해결 방법</strong>을 찾을 수 있습니다. static 변수지정하여 DI한다거나 애플케이션컨텍스트내에서 빈을 찾아 등록한다거나 <strong>약간은 매끄럽지 못한 방법</strong>으로 해결하는 방법을 재시합니다.<br />
하지만 저는 <strong>개인적으로 ApplicationEvent를 통하여 event pub/sub 구조로 한번더 분리</strong>하여 해결하는 방법을 추천합니다.</p>

<h3 id="rider-엔티티-변경-이벤트를-정의">Rider 엔티티 변경 이벤트를 정의</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderEntityEvent</span> <span class="kd">extends</span> <span class="n">ApplicationEvent</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Rider</span> <span class="n">rider</span>

    <span class="kd">public</span> <span class="nf">RiderEntityEvent</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">rider</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">rider</span> <span class="o">=</span> <span class="n">rider</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="rider-엔티티-변경-이벤트-발행">Rider 엔티티 변경 이벤트 발행</h3>
<p><strong>ApplicationEvent</strong> 이용하여 event를 발행합니다. <strong>ApplicationEventPublisher가 @Autowired DI되는 이유</strong>는 <strong>repository</strong>나 <strong>service</strong> 처럼 사용자가 생성한 빈이 아니라 <strong>스프링이 제공하는 이미 등록된 기능의 빈</strong>이기 때문에 <strong>RiderEntityListener</strong>가 생성시 <strong>이미 ApplicationEventPublisher는 존재</strong>하기 때문입니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderEntityListener</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">ApplicationEventPublisher</span> <span class="n">applicationEventPublisher</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">RiderEntityListener</span><span class="o">(</span><span class="n">ApplicationEventPublisher</span> <span class="n">applicationEventPublisher</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">applicationEventPublisher</span> <span class="o">=</span> <span class="n">applicationEventPublisher</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * INSERT 이후 호출됨
     * @param riderAccount
     */</span>
    <span class="nd">@PostPersist</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postPersist</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">applicationEventPublisher</span><span class="o">.</span><span class="na">publishEvent</span><span class="o">(</span><span class="k">new</span> <span class="n">RiderEntityEvent</span><span class="o">(</span><span class="n">rider</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * UPDATE 완료 후 호출
     * @param riderAccount
     */</span>
    <span class="nd">@PostUpdate</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postUpdate</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">applicationEventPublisher</span><span class="o">.</span><span class="na">publishEvent</span><span class="o">(</span><span class="k">new</span> <span class="n">RiderEntityEvent</span><span class="o">(</span><span class="n">rider</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>각 메소드에 이벤트를 발행하는 코드만 생성합니다.<br />
이렇게 이벤트만 발행 하도록 함으로써 추후 이 이벤트를 구독하여 로그를 남긴다거나 이메일을 보낸다거나 기타 여러가지 작업을 pub/sub형태로 개별적으로 코드를 분리하여 작성가능하므로 더 낳은 구조라고 생각합니다.</p>
</blockquote>

<h4 id="위-방법이-아니라면-아마도-이런-구조">위 방법이 아니라면 아마도 이런 구조</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderEntityListener</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="nd">@PostPersist</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postPersist</span><span class="o">(</span><span class="n">Rider</span> <span class="n">rider</span><span class="o">)</span> <span class="o">{</span>
       <span class="err">로그저저장하기</span><span class="o">()</span>
       <span class="err">이메일발송하기</span><span class="o">()</span>
       <span class="err">외부</span><span class="n">API</span><span class="err">호출하기</span><span class="o">()</span>
       <span class="c1">//계속적인 코드추가...</span>
    <span class="o">}</span>

    <span class="o">...</span>
</code></pre></div></div>
<blockquote>
  <p>postPersist 메소드에 수많은 기능이 추가 되겠네요….</p>
</blockquote>

<h3 id="발행된-이벤트를-구독하는-클래스">발행된 이벤트를 구독하는 클래스</h3>
<p><strong>RiderEntityEvent</strong>를 구독하여 처리하는 다수의 핸들러 클래스를 정의하고 사용합니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 스냅샷 저장 </span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderEntityLogEventHandlerImpl</span> <span class="kd">implements</span> <span class="n">RiderEntityLogEventHandler</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">RiderLogRepository</span> <span class="n">riderLogRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@EventListener</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">RiderEntityEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">riderLogRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getRider</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 이메일발송</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RiderSendEmailHandlerImpl</span> <span class="kd">implements</span> <span class="n">RiderSendEmailHandler</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">EmailService</span> <span class="n">emailService</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="nd">@EventListener</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handle</span><span class="o">(</span><span class="n">RiderEntityEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">emailService</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getRider</span><span class="o">())</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>이벤트를 구독하여 처리하는 클래스를 계속적으로 추가할 수 있습니다.</p>
</blockquote>

<h3 id="마무리">마무리</h3>
<p><strong>@EntityListeners</strong>에 등록한 클래스는 <strong>스프링의 관리영역이 아니기</strong> 때문에 <strong>사용자가 생성한 빈을 사용할 때는 null</strong> 값이 되는 경우가 있습니다.<br />
하지만 <strong>ApplicationEventPublisher</strong>를 사용하여 스프링 <strong>이벤트 발생/구독 모델로 분리</strong>하고 정상적으로 <strong>사용자가 생성한 스프링빈을 사용할 수 있는 방법</strong>을 알아 보았습니다.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!-- 포스트 하위 영역에 표시되는 부분이라서 제거함 검색 버튼 틀릭 했을 때 레이어에 셍기는 검색이랑 다른 부분임 -->
            
                <!-- <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Search mogomezwai</h3>
                    <p class="subscribe-overlay-description">Post를 검색 하세요.</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search?query=" + url;
            }
        }
    </script>
</span>

                </section> -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/author-kimchanjung-image-icon.png" alt="kimchanjung" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/kimchanjung">김찬정</a></h4>
                                
                                    <p>좀 더 넓은 TEST 커버리지! 좀 더 나은 Architecture! 좀 더 나은 Code Pattern! 보다 더 간결하고 깔끔한 코드!를 항상 갈망 합니다.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/kimchanjung">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
            
                <section class="post-full-comments">
<script src="https://utteranc.es/client.js"
        repo="kimchanjung/utterance-comments"
        issue-term="[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
</section>                           

            
        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/new-blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; mogomezwai &mdash;</small>
                            
                                <h3 class="read-next-card-header"><a href="/tag/programming/">Programming</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/programming/2020/07/05/typescipt-import-js-module-error/">[typescript] npm 모듈 import시 오류를 해결하는 방법(d.ts 파일 생성법)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/programming/2020/07/03/spring-security-03/">[Spring Security] 스프링시큐리티 커스텀 필터의 구현(3)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/programming/2020/07/02/spring-security-02/">[Spring Security] 스프링시큐리티 설정값들의 역할과 설정방법(2)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/programming/">
                                
                                    See all 14 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/programming/2020/07/01/spring-security-01/">
                <div class="post-card-image" style="background-image: url(/assets/post-img/spring-security/spring-security-flow-diagram.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/programming/2020/07/01/spring-security-01/">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Programming</span>
                            
                        
                    

                    <h2 class="post-card-title">[Spring Security] 스프링시큐리티 동작구조의 이해(1)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/author-kimchanjung-image-icon.png" alt="김찬정" />
                        
                        <span class="post-card-author">
                            <a href="/author/kimchanjung/">김찬정</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/programming/2020/06/26/react-spinner/">
                <div class="post-card-image" style="background-image: url(/assets/images/post-default-react-cover.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/programming/2020/06/26/react-spinner/">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Programming</span>
                            
                        
                    

                    <h2 class="post-card-title">[React] 로딩처리용 spinner를 사용시 position 옵션 문제를 Portal을 사용해 해결하는 방법</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/author-kimchanjung-image-icon.png" alt="김찬정" />
                        
                        <span class="post-card-author">
                            <a href="/author/kimchanjung/">김찬정</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://kimchanjung.github.io/">
            
                <img src="/assets/images/favicon.png" alt="mogomezwai icon" />
            
            <span>mogomezwai</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">[Spring] JPA EntityListeners에서 @Autowired를 통한 의존성 주입이 미동작하는 문제 해결</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=%5BSpring%5D+JPA+EntityListeners%EC%97%90%EC%84%9C+%40Autowired%EB%A5%BC+%ED%86%B5%ED%95%9C+%EC%9D%98%EC%A1%B4%EC%84%B1+%EC%A3%BC%EC%9E%85%EC%9D%B4+%EB%AF%B8%EB%8F%99%EC%9E%91%ED%95%98%EB%8A%94+%EB%AC%B8%EC%A0%9C+%ED%95%B4%EA%B2%B0&amp;url=https://kimchanjung.github.ioprogramming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://kimchanjung.github.ioprogramming/2020/06/28/spring-jpa-antity-listner-autowired-not-working/"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <i class="fab fa-facebook-square"></i>
                <section class="copyright"><a href="https://kimchanjung.github.io/">mogomezwai</a> &copy; 2020</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    <a href="https://facebook.com/mogomezwai" target="_blank" rel="noopener">Facebook</a>
                    <a href="https://twitter.com/mogomezwai" target="_blank" rel="noopener">Twitter</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                    <img class="subscribe-overlay-logo" src="/assets/images/mogomezwai-logo.png" alt="mogomezwai" />
                
                <h1 class="subscribe-overlay-title">Search mogomezwai</h1>
                <p class="subscribe-overlay-description">Post를 검색 하세요.</p>
                <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()" 
               id="searchtext" type="text" name="searchtext"  
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search?query=" + url;
            }
        }
    </script>
</span>

            </div>
        </div>
    

    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <!--script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script-->


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->
    
    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
    if (window.location.hostname != "localhost") {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-165866221-1', 'auto');
        ga('send', 'pageview');
    }
 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
